---
// index.astro
import { sanity } from '../lib/sanity'
import { getTeamMembers } from '@/data/team'
import { getBrands } from '@/data/brands'

// Query: Site settings singleton with all global content
const settingsQuery = `
  *[_id == "siteSettings"]{
    siteTitle,
    siteTagline,
    seo {
      metaTitle,
      metaDescription
    },
    footerTitle {
      line1,
      line2
    },
    contactInfo {
      text,
      textAfterBreak,
      email
    },
    socialLinks[]{
      url,
      ariaLabel,
      svgPath
    }
  }[0]
`;

// Query: Hero section with video and poster
const heroQuery = `
  *[_type == "hero"][0]{
    video {
      asset->{
        url
      }
    },
    poster {
      asset->{
        url
      }
    },
    ariaLabel
  }
`;

// Query: Intro section with asterisk and sections
const introQuery = `
  *[_type == "introSection"][0]{
    asterisk,
    section1{
      title{ line1, line2 },
      paragraph
    },
    section2{
      title{ line1, line2 },
      paragraph
    },
    section3{
      title{ line1, line2 },
      paragraph
    },
    section4{
      title{ line1, line2 },
      paragraph
    }
  }
`;

// Fetch data from Sanity
const settings = await sanity.fetch(settingsQuery);
const hero = await sanity.fetch(heroQuery);
const intro = await sanity.fetch(introQuery);
const team = await getTeamMembers();
const brands = await getBrands();

// Build page title and description
const baseTitle = settings.siteTagline
  ? `${settings.siteTitle} | ${settings.siteTagline}`
  : settings.siteTitle;

const pageTitle =
  settings?.seo?.metaTitle ?? baseTitle;

const pageDescription =
  settings?.seo?.metaDescription ??
  'Hot Lava Agency delivers innovative, non-toxic advertising solutions. We specialize in creative strategy, digital marketing, and brand development for forward-thinking companies.';

import BaseLayout from '../layouts/BaseLayout.astro';
import Loader from '../components/Loader.astro';
import Header from '../components/Header.astro';
import Nav from '../components/Nav.astro';
import Copyright from '../components/Copyright.astro';
import Footer from '../components/Footer.astro';
import Modal from '../components/Modal.astro';
import Hero from '../components/sections/Hero.astro';
import Intro from '../components/sections/Intro.astro';
import About from '../components/sections/About.astro';
import Work from '../components/sections/Work.astro'; 
import Products from '../components/sections/Products.astro';
import Canvas from '../components/Canvas.astro';
import '../styles/global.scss';
---

<BaseLayout
  title={pageTitle},
  description={pageDescription},
  canonical="/"
  includeVimeo={true}
  preloadImages={[
    '/images/phrase.jpg',
    '/images/flow.jpg',
    '/team/kristi.jpg',
    '/team/phil.jpg',
    '/team/nik.jpg',
    '/team/ben.jpg',
  ]}
>
  <a class="skip-link" href="#main-content">Skip to content</a>
  <Loader />
  <canvas id="fluid"></canvas>
  <Modal />

  <Header />
  <Nav siteSettings={settings}/>
  <Copyright />

  <main id="main-content">
    <h1 class="sr-only">{settings.siteTitle}</h1>
    <Hero hero={hero} />
    <Intro config={intro} />

    <About team={team} /> 
    <Work />
    <Products />
  </main>
  <Footer siteSettings={settings}/> 
  <Canvas />

  <script>
    import '../scripts/main.js';
    import '../scripts/smoke.js';
  </script>

</BaseLayout>

