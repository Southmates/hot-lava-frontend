---
// Hero.astro

const videoConfig = {
  source: {
    src: "/hero/010727471-volcanic-eruption.mp4",
    type: "video/mp4",
  },
  settings: {
    autoplay: true,
    muted: true,
    loop: true,
    playsinline: true,
    preload: "auto",
  },
  poster: "/hero/010727471-volcanic-eruption.jpg",
  ariaLabel: "Hot Lava Agency - Vulcan erupts",
};

const logoSvg = {
  width: "585",
  height: "341",
  viewBox: "0 0 585 341",
  ariaLabel: "Hot Lava Agency Logo",
  paths: [
    "M522.995 340.799L481.538 181.261H460.247H436.485H415.194L373.737 340.799H418.79L425.257 315.948H471.495L477.963 340.799H523.015H522.995ZM461.673 278.139H435.079L448.376 226.972L461.673 278.139ZM428.893 47.1555H477.119V0.361038H428.893V0.240697H382.033V0.361038H333.807V47.1555H382.033V160.943H428.893V47.1555ZM325.009 83.3997C325.009 37.3273 287.89 0 242.095 0C196.299 0 159.18 37.3473 159.18 83.3997C159.18 129.452 196.299 166.819 242.095 166.819C287.89 166.819 325.009 129.472 325.009 83.3997ZM278.289 83.3997C278.289 103.517 262.08 119.824 242.095 119.824C222.109 119.824 205.9 103.517 205.9 83.3997C205.9 63.2819 222.109 46.975 242.095 46.975C262.08 46.975 278.289 63.2819 278.289 83.3997ZM172.819 181.261H151.528L110.07 340.799H155.123L161.591 315.948H207.828L214.296 340.799H259.348L217.891 181.261H172.839H172.819ZM171.413 278.139L184.709 226.972L198.006 278.139H171.413ZM92.2141 160.441H142.107V0.361038H92.2141V63.4022H49.9133V0.862479H0V160.943H49.9133V101.191H92.2141V160.421V160.441ZM49.9133 180.92H0V341H49.9133V340.799H97.8783V294.005H49.9133V180.92ZM245.971 181.261L287.428 340.799H346.521L387.978 181.261H342.926L316.975 281.128L291.024 181.261H245.971Z",
    "M584.96 217.044L577.046 194.399L558.005 200.997V181.241H533.982V200.657L515.362 194.479L507.649 217.184L526.791 223.542L514.157 239.809L532.958 254.732L546.214 237.823L557.985 254.23L577.669 240.471L565.657 223.703L585 217.003L584.96 217.044Z",
  ],
};
---

<a id="home"></a>
<section id="hero" class="hero">
  <div class="wrapper"></div>

  <div class="hero-content">
    <div class="logo">
      <svg
        width={logoSvg.width}
        height={logoSvg.height}
        viewBox={logoSvg.viewBox}
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-label={logoSvg.ariaLabel}
        role="img"
      >
        {logoSvg.paths.map((path) => (
          <path d={path} fill="white" />
        ))}
      </svg>
    </div>

    <div class="video">
      <video
        autoplay={videoConfig.settings.autoplay}
        muted={videoConfig.settings.muted}
        loop={videoConfig.settings.loop}
        playsinline={videoConfig.settings.playsinline}  
        preload={videoConfig.settings.preload}
        poster={videoConfig.poster}
        aria-label={videoConfig.ariaLabel}
      >
        <source src={videoConfig.source.src} type={videoConfig.source.type} />
      </video>
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';
  import { initParallax } from '../../scripts/utils/parallax.js';

  // Get elements
  const heroContent = document.querySelector('.hero .hero-content');
  const heroVideo = document.querySelector('.hero .video video');
  const heroLogo = document.querySelector('.hero .logo');
  const navbar = document.querySelector('.navbar');
  const navItems = document.querySelectorAll('.navbar li');

  // Set initial states
  if (heroVideo) {
    gsap.set(heroVideo, { opacity: 0 });
  }
  if (heroLogo) {
    gsap.set(heroLogo, { 
      opacity: 0,
      y: 50, // Start below
    });
  }
  if (navItems.length > 0) {
    gsap.set(navItems, {
      opacity: 0,
      y: 30, // Start below
    });
  }

  // Hero entrance timeline - synchronized with loader
  function initHeroTimeline() {
    const tl = gsap.timeline({
      defaults: { ease: 'power2.out' },
    });

    // Hero content mask and opacity animation: 0s
    if (heroContent) {
      tl.to(heroContent, {
        opacity: 1,
        clipPath: 'inset(0 0 0 0)', // Reveal mask
        duration: 2.5,
        ease: 'power3.out', // Smoother easing for mask
      }, 0);
    }

    // Video animation: 0s - 2s
    if (heroVideo) {
      tl.to(heroVideo, {
        opacity: 1,
        duration: .8,
      }, 0);
    }

    // Logo animation: starts at 1s (halfway through video), duration 2s
    // Logo with vertical movement
    if (heroLogo) {
      tl.to(heroLogo, {
        opacity: 1,
        y: 0, // Move to original position
        duration: 1.5,
        ease: 'power3.out',
      }, .25);
    }

    // Nav items animation: starts at 2.5s (halfway through logo), duration 2s
    // Each nav item enters with stagger
    if (navItems.length > 0) {
      tl.to(navItems, {
        opacity: 1,
        y: 0, // Move to original position
        duration: 0.8,
        stagger: 0.1, // 0.1s delay between each item
        ease: 'power2.out',
      }, .5);
    }

    return tl;
  }

  // Listen for loader completion
  window.addEventListener('loaderComplete', () => {
    initHeroTimeline();
  });

  // Fallback: if loader already completed
  if (document.readyState === 'complete') {
    setTimeout(() => {
      const loader = document.getElementById('loader');
      if (!loader || loader.classList.contains('loader--hidden')) {
        initHeroTimeline();
      }
    }, 100);
  }

  // Animación de rotación continua para el asterisco
  const asterisk = document.querySelector('#asterisk-hero') as SVGPathElement;
  if (asterisk) {
    const svg = asterisk.closest('svg') as SVGSVGElement;
    if (svg) {
      const pathRect = asterisk.getBBox();
      const centerX = pathRect.x + pathRect.width / 2;
      const centerY = pathRect.y + pathRect.height / 2;

      gsap.set(asterisk, {
        transformOrigin: `${centerX}px ${centerY}px`,
      });

      gsap.to(asterisk, {
        rotation: 360,
        duration: 3,
        ease: 'none',
        repeat: -1,
      });
    }
  }

  // Parallax para el logo
  initParallax('.hero .logo', {
    speed: -1  // Se mueve más lento que el scroll
  });

  // Parallax para el video
  initParallax('.hero .video', {
    speed: 1.75  // Se mueve un poco más rápido que el logo
  });
</script>
