---
// Works.astro
import BrandsCarousel from '../BrandsCarousel.astro';

interface WorkItem {
  brand: string;
  name: string;
  slide: string;
  image: string;
  videoUrl?: string;
}

interface Props {
  asterisk?: string;
  title?: string;
  works?: WorkItem[];
  carouselTitle?: string;
  carouselDuration?: number;
}

// Default works data - will be replaced by CMS data
const defaultWorks: WorkItem[] = [
  // { brand: 'P&G', name: 'Collision', slide: 'Collision', image: '/work/p&g--collision.jpg', videoUrl: '' },
  // { brand: 'P&G', name: 'First-Time Fresh', slide: 'First-Time Fresh', image: '/work/p&g--first-time-fresh.jpg', videoUrl: '' },
  { brand: 'Dehnco', name: 'The Most Classic Design', slide: 'The Most Classic Design', image: '/work/dehnco--the-most-classic-design.jpg', videoUrl: 'https://vimeo.com/1088839478' },
  { brand: 'Arrow Electronics', name: 'The Speed of Arrow', slide: 'The Speed of Arrow', image: '/work/arrow--the-speed-of-arrow.jpg', videoUrl: 'https://vimeo.com/1111855559' },
  { brand: 'Dole Packaged Foods', name: 'Dolemates', slide: 'Dolemates', image: '/work/dole--dolemates.jpg', videoUrl: 'https://vimeo.com/1154846381' },
  { brand: 'Max Pawn Luxury', name: 'We Know Real', slide: 'We Know Real', image: '/work/max-pawn--luxury-we-know-real.jpg', videoUrl: 'https://vimeo.com/1154847059' }, 
];

const {
  asterisk = '*',
  title = 'See how we flow',
  works = defaultWorks,
  carouselTitle = 'Our expertise flows across CPG, B2B and retail.',
  carouselDuration = 40,
} = Astro.props;
---

<section id="work" class="works">  
  <!-- <div class="logo logo--vertical">
    <img src="/logo-hot-lava-gradient.svg" alt="Hot Lava">
  </div> -->
  <div class="wrapper">
    <div class="container works__container">
      <h3 class="title" style="max-width: 400px;">
        <span class="asterisk">{asterisk}</span>{title}
      </h3>
      
      <div class="works__list">
        {works.map((work) => (
          <div class="work">
            <div 
              class={`work__item js-work ${work.videoUrl ? 'js-work--has-video' : ''}`}
              data-slide={work.slide}
              data-video={work.videoUrl || ''}
            >
              {work.brand && <span class="brand">{work.brand}</span>}
              <div class="name">
                <p>{work.name}<span class="underline"></span></p>
              </div>
              <img 
                src={work.image} 
                alt={work.name}
                class="work__image"
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>

      <div class="works__images">
        <!-- Work images will be loaded dynamically -->
      </div>
    </div>
  </div>

  <div class="container logos">
    <BrandsCarousel 
      title={carouselTitle}
      duration={carouselDuration}
    />
  </div>
</section>

<script>
  import { initSplitText } from '../../scripts/utils/splittext.js';
  import gsap from 'gsap';

  // Initialize underline animation on hover
  function initUnderlineAnimation() {
    const workItems = document.querySelectorAll('.work__item');
    
    workItems.forEach((item) => {
      const underline = item.querySelector('.name p .underline') as HTMLElement;
      if (!underline) return;

      // Set initial state
      gsap.set(underline, {
        width: 0,
      });

      // Animate on hover
      item.addEventListener('mouseenter', () => {
        gsap.to(underline, {
          width: '100%',
          duration: 0.4,
          ease: 'power3.out', // Smooth custom ease
        });
      });

      // Reverse on mouse leave
      item.addEventListener('mouseleave', () => {
        gsap.to(underline, {
          width: 0,
          duration: 0.4,
          ease: 'power3.in', // Smooth custom ease
        });
      });
    });
  }

  if (typeof window !== 'undefined') {
    if (document.readyState === 'complete') {
      initUnderlineAnimation();
    } else {
      window.addEventListener('load', initUnderlineAnimation);
    }
  }

  // Position work images vertically aligned with their corresponding text
  function positionWorkImages() {
    const workItems = document.querySelectorAll('.work__item');
    
    workItems.forEach((item) => {
      const image = item.querySelector('.work__image') as HTMLElement;
      if (!image) return;

      const updatePosition = () => {
        const rect = item.getBoundingClientRect();
        const centerY = rect.top + rect.height / 2;
        image.style.top = `${centerY}px`;
        image.style.transform = `translateY(-50%) translateX(40px)`;
      };

      // Update position on load and scroll
      updatePosition();
      window.addEventListener('scroll', updatePosition, { passive: true });
      window.addEventListener('resize', updatePosition, { passive: true });

      // Update on hover
      item.addEventListener('mouseenter', () => {
        updatePosition();
        image.style.transform = `translateY(-50%) translateX(0)`;
      });
    });
  }

  if (typeof window !== 'undefined') {
    if (document.readyState === 'complete') {
      positionWorkImages();
    } else {
      window.addEventListener('load', positionWorkImages);
    }
  }

  // Initialize SplitText for footer title
  const title = document.querySelector('.works h3.title') as HTMLElement;
  if (title) {
    initSplitText(title, { 
      type: 'character',
      stagger: 0.02  // More overlap between characters
    });
  }
 
</script>
