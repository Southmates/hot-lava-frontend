---
// Intro.astro

interface IntroImage {
  src: string;
  alt: string;
  class?: string;
  critical?: boolean;
  loading?: "eager" | "lazy";
  position?: "top" | "row";
}

interface IntroTitle {
  line1: string;
  line2?: string | null;
}

interface IntroSection {
  id: string;
  class?: string;
  title: IntroTitle;
  paragraph?: string | null;
  paragraphClass?: string | null;
  image?: IntroImage | null;
  layout?: "row" | "default"; // Determina si usa intro__row o no
}

interface IntroConfig {
  asterisk?: string;
  sections: IntroSection[];
  asteriskLinesImage?: {
    src: string;
    alt: string;
    class?: string;
  };
}

// Default data - will be replaced by CMS data
const defaultConfig: IntroConfig = {
  asterisk: "*",
  sections: [
    {
      id: "intro-first",
      class: "intro__section--first",
      title: {
        line1: "Hot Lava is our phrase for epiphany. We had one and that's why we're here...",
        line2: null,
      },
      paragraph: null,
      paragraphClass: null,
      image: {
        src: "/images/phrase.jpg",
        alt: "Hot Lava is our phrase for epiphany.",
        class: "image-phrase",
        critical: true,
        loading: "eager",
        position: "top",
      },
      layout: "default",
    },
    {
      id: "intro-second",
      class: "intro__section--second",
      title: {
        line1: "Ideas need to",
        line2: "flow more freely.",
      },
      paragraph:
        "It's never been more important. With the complexities of todays marketing challenges, ideas need to flow freely to be effective across audiences, platforms and cultures.",
      paragraphClass: "paragraph-intro",
      image: {
        src: "/images/flow.jpg",
        alt: "Ideas need to flow more freely.",
        class: "image-ideas",
        critical: true,
        loading: "eager",
        position: "top",
      },
      layout: "default",
    },
    {
      id: "intro-third",
      class: "intro__section--third",
      title: {
        line1: "Flow starts with",
        line2: "the way we work.",
      },
      paragraph:
        "We're a full-service advertising agency that gives clients direct access to award-winning creators and doers. Our team is simply an extension of yours â€“ with personal service, an agile approach, and effective, defining work.",
      paragraphClass: null,
      image: null,
      layout: "default",
    },
    {
      id: "intro-fourth",
      class: "intro__section--fourth",
      title: {
        line1: "The best ideas",
        line2: "know no bounds.",
      },
      paragraph:
        "They flood our thoughts, ignite our emotions and build enough momentum to change the way we act. Ideas that flow are what the modern marketer needs to thrive.",
      paragraphClass: null,
      image: null,
      layout: "default",
    },
  ],
  asteriskLinesImage: {
    src: "/images/asterisk-lines.svg",
    alt: "Hot Lava",
    class: "asterisk-lines",
  },
};

// Accept props from CMS or use defaults
interface Props {
  config?: IntroConfig;
}

const { config = defaultConfig } = Astro.props;

const asterisk = config.asterisk || "*";
const sections = config.sections;
const asteriskLinesImage = config.asteriskLinesImage;
---

<section class="intro asterisk-lines-container" id="intro">
  {sections.map((section) => (
    <section
      class={`intro__section ${section.class || ""}`.trim()}
      id={section.id}
    >
      <div class="wrapper">
        {section.image && section.image.position === "top" && (
          <div class={section.image.class || ""}>
            <img
              src={section.image.src}
              alt={section.image.alt}
              data-critical={section.image.critical ? "true" : undefined}
              loading={section.image.loading || "lazy"}
            />
          </div>
        )}
        <div class="container">
          <h3 class="title">
            <span class="asterisk">{asterisk}</span>
            {section.title.line1}
            {section.title.line2 && (
              <>
                <br />
                {section.title.line2}
              </>
            )}
          </h3>
          {section.layout === "row" && section.paragraph ? (
            <div class="intro__row">
              {section.image && section.image.position === "row" && (
                <div class={section.image.class || ""}>
                  <img
                    src={section.image.src}
                    alt={section.image.alt}
                    data-critical={section.image.critical ? "true" : undefined}
                    loading={section.image.loading || "lazy"}
                  />
                </div>
              )}
              <p class={`paragraph ${section.paragraphClass || ""}`.trim()}>
                {section.paragraph}
              </p>
            </div>
          ) : (
            section.paragraph && (
              <p class={`paragraph ${section.paragraphClass || ""}`.trim()}>
                {section.paragraph}
              </p>
            )
          )}
        </div>
      </div>
    </section>
  ))}
  {asteriskLinesImage && (
    <img
      src={asteriskLinesImage.src}
      alt={asteriskLinesImage.alt}
      class={asteriskLinesImage.class || ""}
    />
  )}
</section>

<script>
  import { initSplitText } from '../../scripts/utils/splittext.js';
  import { waitForAssets } from '../../scripts/utils/images-ready.js';
  import { initParallax } from '../../scripts/utils/parallax.js';
  import { initUkiyo } from '../../scripts/utils/ukiyo.js';
  import { initFadeIn } from '../../scripts/utils/fade-in.js';

  // Animation configurations - can be moved to CMS if needed
  const parallaxConfigs = [
    { selector: '.intro__section--first h3.title', speed: -.5 },
    { selector: '.image-phrase', speed: 1.75 },
    { selector: '.intro__section--second h3.title', speed: -.5 }, 
    { selector: '.intro__section--second .paragraph-intro', speed: -.75 },
    { selector: '.image-ideas', speed: 1.75 },
    { selector: '.asterisk-lines', speed: 2.5 },
    { selector: '.intro__section--third h3.title', speed: -.5 },
    { selector: '.intro__section--third .paragraph', speed: -.75 },
    { selector: '.intro__section--fourth h3.title', speed: -.5 },
    { selector: '.intro__section--fourth .paragraph', speed: -.75 },
  ];

  const ukiyoConfigs = [
    { selector: '.intro__section--first .image-phrase img', scale: 1.25, speed: 1 },
    { selector: '.intro__section--second .image-ideas img', scale: 1.25, speed: 1 },
  ];

  waitForAssets(() => {
    const titles = document.querySelectorAll('.intro__section h3.title');
    titles.forEach((title) => {
      initSplitText(title as HTMLElement, { type: 'words' });
    });

    const paragraphs = document.querySelectorAll('.intro__section .paragraph');
    paragraphs.forEach((paragraph) => {
      initSplitText(paragraph as HTMLElement, { type: 'lines' });
    });

    // Initialize fade-in for intro images
    initFadeIn('.image-phrase img', {
      start: '50%',
      duration: 2.4,
      y: 40,
      ease: 'power4.out',
    });

    initFadeIn('.image-ideas img', {
      start: '50%',
      duration: 2.4,
      y: 40,
      ease: 'power4.out',
    });
  });

  parallaxConfigs.forEach((config) => {
    initParallax(config.selector, { speed: config.speed });
  });

  ukiyoConfigs.forEach((config) => {
    initUkiyo(config.selector, {
      scale: config.scale,
      speed: config.speed,
    });
  });
</script>
