---
// About.astro

interface TeamMember {
  name: string;
  surname: string;
  image: string;
  bio: string;
}

interface AboutIntro {
  title: string;
  // paragraph: string;
}

interface Props {
  asterisk?: string;
  intro?: AboutIntro;
  team?: TeamMember[];
  logo?: {
    src: string;
    alt: string;
    style?: string;
  };
}

// Default data - will be replaced by CMS data
const defaultIntro: AboutIntro = {
  title: 'Who we are',
  // paragraph: 'Could we add some text here...?',
};

const defaultTeam: TeamMember[] = [
  {
    name: 'Ben',
    surname: 'Kline',
    image: '/team/ben.jpg',
    bio: "Previously CMO for Ogilvy, and CSO at Leo Burnett, Ben is an industry veteran who has made invaluable strategic contributions to a diverse portfolio of global brands.",
  },
  {
    name: 'Nik',
    surname: 'Traxler',
    image: '/team/nik.jpg',
    bio: "Nik is an award-winning producer whose talent flexes to agency operations. With global brand and agency experience, he goes above and beyond in pursuit of excellence.",
  },
  {
    name: 'Phil',
    surname: 'Jungmann',
    image: '/team/phil.jpg',
    bio: "Phil's thoughtful and boundary-pushing art direction and creative leadership has resulted in impactful and award-winning work for the world's top brands, at the best agencies in Chicago and NYC.",
  },
  {
    name: 'Kristi',
    surname: 'Neitzel',
    image: '/team/kristi.jpg',
    bio: "Kristi is a creative leader and writer with a client roster of Fortune 500 greats. Her ability to manage, motivate and organize agency and client-side teams that work together seamlessly is unmatched.",
  },
];

const defaultLogo = {
  src: '/logo-hot-lava-outline.svg',
  alt: 'Hot Lava',
  style: 'opacity: .25; filter: invert(1) saturate(10);',
};

const {
  asterisk = '*',
  intro = defaultIntro,
  team = defaultTeam,
  logo = defaultLogo,
} = Astro.props;
---

<section id="about-us" class="about">
  <div class="wrapper">
    <div class="container about__intro"> 
      <h3 class="title">
        <span class="asterisk">{asterisk}</span>{intro.title}
      </h3>
      <!-- <p class="paragraph">{intro.paragraph}</p> -->
    </div> 
    
    <div class="container about__team">
      <div class="team"> 
        {team.map((member) => (
          <div class="team__card">  
            <h3 class={`team__name team__name--${member.name.toLowerCase()}`}>{member.name} <span class="team__surname">{member.surname}</span></h3>
            <picture>
              <img 
                src={member.image} 
                alt={member.name} 
                data-critical="true" 
                loading="eager" 
              />
              <div class="team__overlay"></div>
            </picture>
            <p class="team__bio">{member.bio}</p>
          </div>
        ))}
      </div>
    </div> 
  </div>

  <div class="logo logo--vertical"> 
    <img 
      src={logo.src} 
      alt={logo.alt} 
      style={logo.style}
    />
  </div>
</section>

<script>
  import { initSplitText } from '../../scripts/utils/splittext.js';
  import { waitForAssets } from '../../scripts/utils/images-ready.js';
  import { initParallax } from '../../scripts/utils/parallax.js';
  import { initUkiyo } from '../../scripts/utils/ukiyo.js';
  import gsap from 'gsap';
  import { SplitText } from 'gsap/SplitText';

  // Wait for fonts and critical images to be ready before initializing SplitText
  waitForAssets(() => {
    // Initialize SplitText for title (words)
    const title = document.querySelector('.about h3.title') as HTMLElement;
    if (title) {
      initSplitText(title, { type: 'character', stagger: 0.02 });
    }

    // Initialize SplitText for bios with hover animation
    const bios = document.querySelectorAll('.about .team__bio') as NodeListOf<HTMLElement>;
    bios.forEach((bio) => {
      const split = new SplitText(bio, {
        type: 'lines',
        linesClass: 'line',
      });

      const lines = split.lines;

      // Set initial state
      gsap.set(lines, {
        opacity: 0,
        y: 50,
      });

      // Get the parent card
      const card = bio.closest('.team__card') as HTMLElement;
      if (!card) return;

      // Store split data on the card for cleanup
      (card as any).__splitData = { split, lines };

      // Animate on hover
      card.addEventListener('mouseenter', () => {
        gsap.to(lines, {
          opacity: 1,
          y: 0,
          duration: 0.8,
          stagger: 0.05,
          ease: 'power2.out',
        });
      });

      // Reverse on mouse leave
      card.addEventListener('mouseleave', () => {
        gsap.to(lines, {
          opacity: 0,
          y: 50,
          duration: 0.5,
          stagger: 0.03,
          ease: 'power2.in',
        });
      });
    });
  });

  initParallax('.about h3.title', {
    speed: -1  
  });

  initParallax('.about .logo--vertical', {
    speed: 7  
  });   

  initUkiyo('.about .team__card img', {
    scale: 1.15,
    speed: 1.1
  });
</script>

<style>
  .lines-about {
    pointer-events: none;
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: auto; 
    opacity: 0.5;
    z-index: -1;
  }
</style>
