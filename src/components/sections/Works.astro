---
// Works.astro
---

<section id="work" class="works">  
  <div class="logo logo--vertical">
    <img src="/logo-hot-lava-gradient.svg" alt="Hot Lava">
  </div>
  <div class="wrapper">
    <div class="container works__container">
      <h3 class="title">
        <span class="asterisk">*</span>See how we flow
      </h3>
      
      <div class="works__list">
        <!-- P&G: Collision -->
        <div class="work">
          <div class="work__item js-work" data-slide="Collision">
            <span class="brand">P&G</span>
            <div class="name">
              <p>Collision</p> 
            </div>
          </div>
        </div> 

        <!-- P&G: First-Time Fresh -->
        <div class="work">
          <div class="work__item js-work" data-slide="First-Time Fresh">
            <span class="brand">P&G</span>
            <div class="name">
              <p>First-Time Fresh</p>
            </div>
          </div>
        </div>

        <!-- Dehnco: The Most Classic Design -->
        <div class="work">
          <div class="work__item js-work" data-slide="The Most Classic Design">
            <span class="brand">Dehnco</span>
            <div class="name">
              <p>The Most Classic Design</p>
            </div>
          </div>
        </div>

        <!-- Arrow Electronics: The Speed of Arrow -->
        <div class="work">
          <div class="work__item js-work" data-slide="The Speed of Arrow">
            <span class="brand">Arrow Electronics</span>
            <div class="name">
              <p>The Speed of Arrow</p>
            </div>
          </div>
        </div>

        <!-- Dole Packaged Foods: Dolemates -->
        <div class="work">
          <div class="work__item js-work" data-slide="Dolemates">
            <span class="brand">Dole Packaged Foods</span>
            <div class="name">
              <p>Dolemates</p>
            </div>
          </div>
        </div>

        <!-- Max Pawn Luxury: We Know Real -->
        <div class="work">
          <div class="work__item js-work" data-slide="We Know Real">
            <span class="brand">Max Pawn Luxury</span>
            <div class="name">
              <p>We Know Real</p>
            </div>
          </div>
        </div>

        <!-- EZ Pawn: You Won’t Believe It -->
        <div class="work">
          <div class="work__item js-work" data-slide="You Won’t Believe It">
            <span class="brand">EZ Pawn</span>
            <div class="name">
              <p>You Won’t Believe It</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Work Images -->
      <div class="works__images">
          <!-- <img src="./works/collision.jpg" alt="Collision"> -->
          <!-- <img src="./works/first-time-fresh.jpg" alt="First-Time Fresh"> -->
          <!-- <img src="./works/the-most-classic-design.jpg" alt="The Most Classic Design"> -->
          <!-- <img src="./works/the-speed-of-arrow.jpg" alt="The Speed of Arrow"> -->
          <!-- <img src="./works/dolemates.jpg" alt="Dolemates"> -->
          <!-- <img src="./works/we-know-real.jpg" alt="We Know Real"> -->
          <!-- <img src="./works/you-won’t-believe-it.jpg" alt="You Won’t Believe It"> -->
      </div>
    </div>
  </div>

  <!-- Logos carousel. -->
  <div class="container logos">
    <h5>
      Our expertise flows across CPG, B2B and retail. 
    </h5>

    <div class="carousel-brands">
      <!-- Fila superior: izquierda a derecha -->
      <div class="brands-row brands-row--top">
        <div class="brands-track brands-track--top">
          <div class="brands"> 
            <img src="./brands/Arrow.png" alt="Arrow">
            <img src="./brands/Dehnco.png" alt="Dehnco">
            <img src="./brands/Dole.png" alt="Dole">
            <img src="./brands/EZ-corp.png" alt="EZ-corp">
            <img src="./brands/Knudsen.png" alt="Knudsen">
            <img src="./brands/P&G.png" alt="P&G">
            <img src="./brands/REW.png" alt="REW">
            <img src="./brands/SpartanNash.png" alt="SpartanNash">
          </div>
          <!-- Duplicado para loop infinito -->
          <div class="brands"> 
            <img src="./brands/Arrow.png" alt="Arrow">
            <img src="./brands/Dehnco.png" alt="Dehnco">
            <img src="./brands/Dole.png" alt="Dole">
            <img src="./brands/EZ-corp.png" alt="EZ-corp">
            <img src="./brands/Knudsen.png" alt="Knudsen">
            <img src="./brands/P&G.png" alt="P&G">
            <img src="./brands/REW.png" alt="REW">
            <img src="./brands/SpartanNash.png" alt="SpartanNash">
          </div>
        </div>
      </div>

      <!-- Fila inferior: derecha a izquierda -->
      <div class="brands-row brands-row--bottom">
        <div class="brands-track brands-track--bottom">
          <div class="brands"> 
            <img src="./brands/Arrow.png" alt="Arrow">
            <img src="./brands/Dehnco.png" alt="Dehnco">
            <img src="./brands/Dole.png" alt="Dole">
            <img src="./brands/EZ-corp.png" alt="EZ-corp">
            <img src="./brands/Knudsen.png" alt="Knudsen">
            <img src="./brands/P&G.png" alt="P&G">
            <img src="./brands/REW.png" alt="REW">
            <img src="./brands/SpartanNash.png" alt="SpartanNash">
          </div>
          <!-- Duplicado para loop infinito -->
          <div class="brands"> 
            <img src="./brands/Arrow.png" alt="Arrow">
            <img src="./brands/Dehnco.png" alt="Dehnco">
            <img src="./brands/Dole.png" alt="Dole">
            <img src="./brands/EZ-corp.png" alt="EZ-corp">
            <img src="./brands/Knudsen.png" alt="Knudsen">
            <img src="./brands/P&G.png" alt="P&G">
            <img src="./brands/REW.png" alt="REW">
            <img src="./brands/SpartanNash.png" alt="SpartanNash">
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { initParallax } from '../../scripts/utils/parallax.js';
  import gsap from 'gsap';

  initParallax('.works .logo', {
    speed: 1  
  });

  // Carrusel infinito de logos
  function initBrandsCarousel() {
    const topTrack = document.querySelector('.brands-track--top') as HTMLElement;
    const bottomTrack = document.querySelector('.brands-track--bottom') as HTMLElement;

    if (!topTrack || !bottomTrack) return;

    // Esperar a que las imágenes se carguen para calcular correctamente el ancho
    const images = document.querySelectorAll('.carousel-brands img');
    let imagesLoaded = 0;
    const totalImages = images.length;

    if (totalImages === 0) {
      // Si no hay imágenes, inicializar de inmediato
      startCarousel();
      return;
    }

    const checkAndStart = () => {
      imagesLoaded++;
      if (imagesLoaded === totalImages) {
        startCarousel();
      }
    };

    images.forEach((img) => {
      if ((img as HTMLImageElement).complete) {
        checkAndStart();
      } else {
        img.addEventListener('load', checkAndStart);
        img.addEventListener('error', checkAndStart);
      }
    });

    function startCarousel() {
      // Calcular el ancho de un set de logos
      const topBrands = topTrack.querySelector('.brands') as HTMLElement;
      const bottomBrands = bottomTrack.querySelector('.brands') as HTMLElement;
      
      if (!topBrands || !bottomBrands) return;

      const topWidth = topBrands.offsetWidth;
      const bottomWidth = bottomBrands.offsetWidth;

      // Fila superior: izquierda a derecha (se mueve hacia la izquierda)
      gsap.fromTo(topTrack, 
        { x: 0 },
        {
          x: -topWidth,
          duration: 40,
          ease: "none",
          repeat: -1,
        }
      );

      // Fila inferior: derecha a izquierda (se mueve hacia la derecha para efecto opuesto)
      gsap.fromTo(bottomTrack,
        { x: -bottomWidth },
        {
          x: 0,
          duration: 40,
          ease: "none",
          repeat: -1,
        }
      );
    }
  }

  // Inicializar cuando el DOM esté listo
  if (typeof window !== 'undefined') {
    if (document.readyState === 'complete') {
      initBrandsCarousel();
    } else {
      window.addEventListener('load', initBrandsCarousel);
    }
  }
</script>
 